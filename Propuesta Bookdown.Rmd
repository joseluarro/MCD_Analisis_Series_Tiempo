---
title: "Propuesta Bookdown"
author: "Jose Luis Arroyave Capera"
date: "2023-04-21"
output:
  bookdown::gitbook:
  css: styles.css
  output:
    bookdown::gitbook:
      config:
        toc:
          before: |
            <br><br><br>
          after: |
            <br><br><br>
          scroll_highlight: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Propuesta Bookdown

Propuesta de qué tipo de información a trabajar a lo largo del curso y por qué cree que es importante el pronóstico de ese tipo de información que permita tener valor agregado a esa situación particular que pretende analizar.

Elaboración de documento tipo \'bookdown\' en GitHub, con máximo una página, con información y justificación de la elección en relación con la importancia de analizar esa información. Especificando las fuentes y los permisos de uso de esa información en caso de ser de una empresa específica.

# Prediccion del precio de la Maracuya para el Valle del Cauca

Uno de los mayores desafios para los agricultores es saber en que momento vender los productos cosechados para así obtener una mayor rentabilidad y poder "jugar" con los diferentes costos y gastos en los que se incurren.

## Motivación

Actualmente hago parte como socio de una empresa dedicada al cultivo y venta de maracuya, por lo que obtener y aportar información como estimaciones de precios sería para mi más satisfactorio que simplemente ser un socio capitalista.

![](images/Foto%20Maracuya.jpg)

Para lograr mi objetivo de prediccion de precios, se cuenta con una base historica desde aproximadamente 5 años atras, junto datos propios de la compañia como lo son los costos y gastos, tambien se cuenta con la experiencia del lider del proyecto quien es Ingeniero Agronomo y puede orientar sobre los costos externos como lo pueden ser el precio de la gasolina, precios de insumos, fertilizantes así como también impacto en las lluvias, cantidad de empresas de la competencia y las zonas. Diferentes datos que pueden ser obtenidos ya que son publicos.

Adicional a lo anterior, me encuentro abierto a los diferentes metodos ya que no hace parte de mi trabajo de grado y lo veo mas como una aplicacion al proyecto personal.

# Historico de precios del Maracuya

```{python}
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

df_precios_historicos = pd.read_excel("historico_precios_maracuya.xlsx")
df_precios_passion = pd.read_excel("INFORME_PRODUCCION.xlsx")


print(df_precios_historicos.head())
print(df_precios_passion.head())
```

```{python}
print(df_precios_historicos.info())
print(df_precios_passion.info())
```

```{python}
print(df_precios_historicos.shape)
print(df_precios_passion.shape)
```

```{python}
print(df_precios_historicos["prom_valle"].describe())
```

```{python}
print(df_precios_passion["VALOR KILO"].describe())
```

```{python}
df_precios_historicos.plot(x="fecha", y="prom_valle")
plt.show()
```

```{python}
# Calcular media por fecha
df_precios_passion_mean = df_precios_passion.set_index('FECHA')
df_precios_media = df_precios_passion_mean.groupby(pd.Grouper(freq='M')).mean()

# Graficar datos y línea de tendencia
df_precios_passion.plot(x="FECHA", y="VALOR KILO")
df_precios_media.plot(y="VALOR KILO", ax=plt.gca(), color='red')
plt.show()
```

# Analisis de la dinamica de los datos

## Estructura de los datos en series de tiempo (precios Valle)

```{python}
import seaborn as sns
from statsmodels.tsa.seasonal import seasonal_decompose
import statsmodels.api as sm
from statsmodels.graphics.tsaplots import plot_acf


# Eliminar valores faltantes
df_precios_historicos.fillna(df_precios_historicos.mean(), inplace=True)

# Calcular promedio móvil
df_precios_historicos['promedio_movil'] = df_precios_historicos['prom_valle'].rolling(window=3).mean()

# Gráfico de la serie de tiempo con el promedio móvil
fig, ax = plt.subplots(figsize=(10, 6))
sns.lineplot(data=df_precios_historicos, x='fecha', y='prom_valle', color='blue', ax=ax)
sns.lineplot(data=df_precios_historicos, x='fecha', y='promedio_movil', color='red', ax=ax)
ax.set(title='Precio promedio de la Maracuya', xlabel='Fecha', ylabel='Precio promedio')
plt.show()

# Gráfico de rezagos
fig, ax = plt.subplots(figsize=(10, 6))
sns.scatterplot(data=df_precios_historicos, x='prom_valle', y=df_precios_historicos['prom_valle'].shift(1), color='blue')
ax.plot(ax.get_xlim(), ax.get_ylim(), ls="--", c=".3") # Agregar línea diagonal
ax.set(title='Rezagos de la serie de tiempo', xlabel='Valor en t', ylabel='Valor en t-1')
plt.show()

# Obtener la serie de tiempo
serie = df_precios_historicos['prom_valle']

# Gráfico de autocorrelación
fig, ax = plt.subplots(figsize=(10, 6))
plot_acf(serie, ax=ax, lags=50)
plt.show()
```

## Estructura de los datos en series de tiempo (precios Passion)

```{python}
import seaborn as sns
from statsmodels.tsa.seasonal import seasonal_decompose
import statsmodels.api as sm
from statsmodels.graphics.tsaplots import plot_acf


# Eliminar valores faltantes
df_precios_passion.fillna(df_precios_passion.mean(), inplace=True)

# Calcular promedio móvil
df_precios_passion['promedio_movil'] = df_precios_passion['VALOR KILO'].rolling(window=3).mean()

# Gráfico de la serie de tiempo con el promedio móvil
fig, ax = plt.subplots(figsize=(10, 6))
sns.lineplot(data=df_precios_passion, x='FECHA', y='VALOR KILO', color='blue', ax=ax)
sns.lineplot(data=df_precios_passion, x='FECHA', y='promedio_movil', color='red', ax=ax)
ax.set(title='Precio promedio de la Maracuya', xlabel='Fecha', ylabel='Precio promedio')
plt.show()

# Gráfico de rezagos
fig, ax = plt.subplots(figsize=(10, 6))
sns.scatterplot(data=df_precios_passion, x='VALOR KILO', y=df_precios_passion['VALOR KILO'].shift(1), color='blue')
ax.plot(ax.get_xlim(), ax.get_ylim(), ls="--", c=".3") # Agregar línea diagonal
ax.set(title='Rezagos de la serie de tiempo', xlabel='Valor en t', ylabel='Valor en t-1')
plt.show()

# Obtener la serie de tiempo
serie = df_precios_passion['VALOR KILO']

# Gráfico de autocorrelación
fig, ax = plt.subplots(figsize=(10, 6))
plot_acf(serie, ax=ax, lags=50)
plt.show()
```

# Preprocesamiento y visualización

```{python}
from statsmodels.tsa.seasonal import seasonal_decompose

# cargar los datos de la serie de tiempo en un DataFrame de pandas
#df_precios_historicos = pd.read_excel("historico_precios_maracuya.xlsx")

# hacer la descomposición
#decomposition = seasonal_decompose(df_precios_historicos)

# mostrar las componentes
#fig, axes = plt.subplots(nrows=4, ncols=1, figsize=(8, 10), sharex=True)
#axes[0].set(title='Serie de tiempo original')
#df_precios_historicos.plot(ax=axes[0])
#axes[1].set(title='Tendencia')
#decomposition.trend.plot(ax=axes[1])
#axes[2].set(title='Estacionalidad')
#decomposition.seasonal.plot(ax=axes[2])
#axes[3].set(title='Residuos')
#decomposition.resid.plot(ax=axes[3])
#plt.show()
```
